# Project Analysis: Il2CppDumper

## Overview
Il2CppDumper is a reverse-engineering utility that reconstructs managed metadata from Unity projects that ship with IL2CPP, enabling analysts to recover DLL stubs, metadata, and helper scripts that improve downstream tooling. The README highlights complete DLL restoration (excluding method bodies), support for Unity versions 5.3 through 2022.2, and compatibility with multiple executable container formats such as ELF, Mach-O, PE, Nintendo NSO, and WebAssembly.【F:README.md†L1-L71】

## Build and Packaging Configuration
The project targets both .NET 6.0 and .NET 8.0, producing a command-line executable. Mono.Cecil is the primary third-party dependency, used for manipulating assemblies during dummy DLL generation. The build embeds WinForms resource metadata (for the OpenFileDialog wrapper) and ensures auxiliary Python helpers plus `config.json` are copied into the output directory so users have the automation scripts alongside the executable.【F:Il2CppDumper/Il2CppDumper/Il2CppDumper.csproj†L1-L61】

## Entry Point and Command-Line Flow
`Program.Main` loads configuration from `config.json`, infers arguments for the IL2CPP binary, metadata file, and output directory, and gracefully falls back to GUI file pickers on Windows when parameters are omitted. It validates argument count, supports `--help`, and prints guidance for incorrect invocation.【F:Il2CppDumper/Il2CppDumper/Program.cs†L13-L118】 After initialization, the tool reports missing metadata, catches unexpected exceptions, and optionally waits for a keypress based on configuration, providing a predictable UX for both automated and interactive use.【F:Il2CppDumper/Il2CppDumper/Program.cs†L89-L111】

## Binary Format Detection and Initialization
During initialization, the tool reads the metadata file into the `Metadata` parser, prints the detected version, and inspects the IL2CPP binary magic value to instantiate the appropriate loader (PE, ELF32/64, Mach-O fat/thin, NSO, or WASM). Mach-O fat binaries trigger a console prompt to pick an architecture slice. Once instantiated, the binary abstraction is configured with either the detected metadata version or a forced override from configuration, and, for ELF dumps, users can input a relocated base address to correct dumped images.【F:Il2CppDumper/Il2CppDumper/Program.cs†L119-L200】

## Registration Search Pipeline
After setup, the program attempts to resolve the IL2CPP `CodeRegistration` and `MetadataRegistration` structures. It first invokes `PlusSearch`, optionally reloading PE images via a custom loader when auto-detection fails. Subsequent fallbacks include signature searches and symbol-based discovery. If automation cannot locate the registrations, the tool prompts the user for manual addresses. For dumped binaries with version ≥27, the metadata image base is adjusted to align type handles with file offsets.【F:Il2CppDumper/Il2CppDumper/Program.cs†L207-L243】

## Metadata Parsing Infrastructure
The `Metadata` class validates the `global-metadata.dat` header, enforces supported version ranges (16–31), and dynamically distinguishes between closely related Unity metadata revisions (24.x variants). It eagerly loads arrays of images, assemblies, types, methods, parameters, fields, properties, events, generics, and string literals into strongly typed structures and builds lookup dictionaries for default values, metadata usages, and custom attributes. The parser also adapts to version-specific layouts, e.g., switching between attribute type ranges and data ranges, and caches string lookups for efficiency.【F:Il2CppDumper/Il2CppDumper/Il2Cpp/Metadata.cs†L10-L200】

## Binary Abstraction Layer
All format-specific readers inherit from `Il2Cpp`, which extends `BinaryStream` to provide random-access parsing. `Il2Cpp` stores arrays of method pointers, generic metadata, codegen modules, and RGCTX dictionaries, and exposes abstract navigation methods (`MapVATR`, `PlusSearch`, `SymbolSearch`, etc.) for concrete format implementations. It also recalibrates IL2CPP version heuristics by inspecting registration counts and re-reading structures when thresholds suggest mis-detections.【F:Il2CppDumper/Il2CppDumper/Il2Cpp/Il2Cpp.cs†L8-L200】 The `BinaryStream` base supplies endian-aware reading/writing, version-aware field selection via `VersionAttribute`, and helper routines for reflective class deserialization from binary blobs, forming the backbone of all binary parsing routines.【F:Il2CppDumper/Il2CppDumper/IO/BinaryStream.cs†L10-L160】

## Execution Model and Type Reconstruction
`Il2CppExecutor` bridges metadata and binary data, resolving IL2CPP type names (including generics, arrays, references, and nested classes), mapping custom attribute generators, and formatting generic parameter lists. Its type table enables other components to materialize IL2CPP data structures into human-readable forms.【F:Il2CppDumper/Il2CppDumper/Utils/Il2CppExecutor.cs†L9-L200】 `DummyAssemblyGenerator` leverages Mono.Cecil plus the embedded `Il2CppDummyDll` template to synthesize .NET assemblies mirroring IL2CPP metadata, preserving nested types, generics, inheritance, interfaces, and optional token attributes for cross-referencing back to IL2CPP metadata indices.【F:Il2CppDumper/Il2CppDumper/Utils/DummyAssemblyGenerator.cs†L11-L160】 The exporter instantiates per-image assemblies, registers dependencies with a custom resolver, and annotates tokens or offsets when requested.【F:Il2CppDumper/Il2CppDumper/Utils/DummyAssemblyGenerator.cs†L56-L160】

## Source Dump and Script Generation
`Il2CppDecompiler` creates `dump.cs`, enumerating each image, namespace, type, and member. It prints inheritance lists, serializable attributes, field declarations with access modifiers, constant values, optional field offsets, and stubs for methods, properties, and events based on configuration flags. This file functions as a map of the IL2CPP metadata with enough detail for manual inspection.【F:Il2CppDumper/Il2CppDumper/Outputs/Il2CppDecompiler.cs†L10-L199】 Complementing this, `StructGenerator` builds `script.json` and accompanying headers that describe struct layouts, method signatures, and RGCTX contexts, while handling naming collisions, generics, and special keywords. It tracks generic instantiations, emits method pointer metadata, and prepares helper arrays used by IDA, Ghidra, and Binary Ninja scripts.【F:Il2CppDumper/Il2CppDumper/Outputs/StructGenerator.cs†L12-L200】

## Reverse-Engineering Helper Scripts
The repository ships several Python scripts that consume `script.json` to annotate disassembly sessions. For example, `ghidra.py` reads Il2CppDumper output, labels methods, strings, metadata entries, and optionally forces function creation across address ranges, streamlining interactive analysis.【F:Il2CppDumper/Il2CppDumper/ghidra.py†L1-L87】 The build copies these scripts into the output folder so users can immediately import them into Ghidra, IDA, or Binary Ninja environments.【F:Il2CppDumper/Il2CppDumper/Il2CppDumper.csproj†L33-L61】

## Configuration Surface
`Config` exposes toggles controlling which metadata elements are dumped, whether dummy DLLs and struct scripts are generated, if tokens should be appended to dummy assemblies, whether the process should pause for a keypress, and optional overrides for IL2CPP version detection or dump pointer handling. These defaults are mirrored in `config.json`, enabling both CLI overrides and post-build customization.【F:Il2CppDumper/Il2CppDumper/Config.cs†L3-L20】【F:Il2CppDumper/Il2CppDumper/config.json†L1-L17】

## Execution Summary
At runtime, the tool orchestrates a linear pipeline: parse configuration, load metadata, select a binary loader, locate registration structures (with multiple fallbacks), and then invoke decompilation, struct generation, and dummy assembly export based on configuration flags. Progress messages (`Initializing metadata`, `Searching`, `Dumping`, `Generate struct`, `Generate dummy dll`) give users clear checkpoints for troubleshooting and automation.【F:Il2CppDumper/Il2CppDumper/Program.cs†L119-L274】

